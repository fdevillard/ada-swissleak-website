<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>ADA: SwissLeak</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css">
  <!-- <link rel="stylesheet" href="css/custom.css"> -->

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

  <!-- JS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="bootstrap/dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/plotly-latest.min.js"></script>
  <script type="text/javascript" src="js/scrollreveal.min.js"></script>
  <script type="text/javascript" src="js/w3data.js"></script>
</head>
<body>


  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container-fluid full-header">
    <div class="fill container">
      <div class="jumbotron">
              <div class="row text-center">
          <div class="col-md-4"><small>Lionel Fleury</small></div>
          <div class="col-md-4"><small>Semion Sidorenko</small></div>
          <div class="col-md-4"><small>Florent Devillard</small></div>
      </div>
        <h1>Switzerland and the Offshore Leaks </h1>
        <p class="lead">Using the <a href="https://offshoreleaks.icij.org/" target="_blank">ICIJ Offshore Leaks Database</a>, this project aims to look into the connections between Switzerland and a small part of the offshore banking world.</p>
      </div>
    </div>
  </div>
    <div class="navbar navbar-fixed-left">
  <ul class="nav navbar-nav">
   <li><a href="#">The ICIJ data</a></li>
   <li><a href="#">Enriching the data</a></li>
   <li><a href="#">Blah</a></li>
   <li><a href="#">Truc</a></li>
  </ul>
  </div>
  <img class="topcorner" src="images/ADA-logo.png"/>
  <div class="container">
    <div class="header">
      <div class="row">
        <div class="col-md-6 col-md-offset-3">



        <p class="very-small disclaimer text-uppercase">
          Published information has been collected carefully but no guarantee
          about its completeness, correctness or up-to-date nature is given. There are legitimate uses for offshore companies and trusts. We do not intend to suggest or imply that any persons, companies or other entities included in the ICIJ Offshore Leaks Database have broken the law or otherwise acted improperly. Many people and entities have the same or similar names.</p>
          <!-- <h1>The ICIJ Data</h1> -->
          <p class="drop-cap">The data we are working with comes from the <a href="https://offshoreleaks.icij.org/" target="_blank">ICIJ</a>. It contains information on almost 500,000 offshore entities that are part of the Panama Papers, the Offshore Leaks and the Bahamas Leaks investigations. The data covers nearly 40 years up to early 2016 and links to people and companies in more than 200 countries and territories. In this report, we will focus on the entities in this database that are either located in Switzerland, or linked to swiss politicians.</p>
          <figure>
          <img src="images/neo4j_query.png" class="img-responsive" alt="Responsive image">
          <figcaption>An example Neo4j query.</figcaption>
          </figure>
          <p>The dump is searchable online, but for our project we downloaded a self-contained database from the ICIJ. The database is given as a Neo4j graph database, where each entity is a node and relationships are edges. This makes it very practical to query and visualize the data dump.</p>
          <figure>
          <img src="images/neo4j_results.png" class="img-responsive" alt="Responsive image">
          <figcaption>Visualization of results for the above query.</figcaption>
          </figure>
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />






        </div>
      </div>
    </div>
  </div>
<!--
  <div class="container values">

  </div>

  <div class="container">
    <h2>The data</h2>
    <p>The data were obtained from the <a
       href="https://panamapapers.icij.org">International Consortium of
       Investigative Journalists</a> (ICIJ). There were all scraped from
     different leaks related to Mossack Fonseca.</p>
  </div>
  <div class="container values">
    <div class="row">
      <div class="one-third column">
        <h2 class="value-magnifier">11,5 million</h2>
        <h5 class="value-header">Leaked documents</h5>
      </div>
      <div class="one-third column">
        <h2 class="value-magnifier">214,000</h2>
        <h5 class="value-header">Offshore companies</h5>
      </div>
      <div class="one-third column">
        <h2 class="value-magnifier">38,000</h2>
        <h5 class="value-header">Entities in Switzerland</h5>
      </div>
    </div>
  </div>
  <div class="container">
    <h2>Timelapse</h2>
    <div class="row">
      <p>This plot gives inside about the different activities around the Panama
      Papers.</p>
      <p>The year means how many entities became invalid, while the <em>still
        active</em> means entities which were still active late 2015.</p>
    </div>
    <div class="row">
      <div class="three columns">
        <button class="primary-button" onclick="next_year()">Next Year</button>
      </div>
      <div class="three columns">
        <button class="primary-button" onclick="set_now()">Still active</button>
      </div>
      <div class="three columns">
        <button class="primary-button" onclick="animate()">Animate</button>
      </div>
      <div class="three columns">
        <p id="current_year"><p>
      </div>
    </div>
    <div class="row">
      <div class="column">
        <div id="tester" class="u-max-full-width"></div>
      </div>
    </div>
    <div class="row">
      <h2>Closer look to cantons</h2>
      <p>Geneva is clearly the most frequent canton (pay attention to the
      log-scale). Surpisingly Lausanne comes second, and Zurich third.</p>
      <img class="u-max-full-width"
      src="data/entities_repartition_per_canton.png" />
      <p>You can see more precise information <a
        href="data/locations.html">here</a>. No
      correctness nor up-to-date nature of the information is
      guaranteed. Furthermore, in no way being on the map is linked with illegal
      activities.</p>
    </div>
  </div> -->

<!-- Let's scripting
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

<script>

var root_data  = undefined;
var plot_div = document.getElementById('tester');
var all_years = undefined;
var current_year = "2015";
var timer = undefined;

function set_now() {
  update_with_year("-1");
}

function animate() {
  if (typeof timer !== "undefined") {
    clearInterval(timer);
  }

  function handler() {
    current_year_idx = all_years.indexOf(current_year);

    if(current_year_idx+1 == all_years.length) {
      clearInterval(timer);
      timer = undefined;
    } else {
      next_year();   
    }
  }

  update_with_year(all_years[0]);
  timer = setInterval(handler, 600);
}

function update_year_label() {
  var text_value = undefined;
  var current_year_as_int = parseInt(current_year);
  console.log(current_year_as_int);
  if (parseInt(current_year) < 0)
    text_value = "Still active";
  else 
    text_value = current_year
  document.getElementById('current_year').innerHTML = text_value;
}

function update_with_year(new_year) {
  current_year = new_year;
  update_year_label();
  data = plot_div.data[0];
  new_data = root_data[new_year];

  data.locations = new_data.locations;
  data.text = new_data.locations;
  data.z = new_data.values;

  Plotly.redraw(plot_div);
}

function next_year() {
  var index = all_years.indexOf(current_year)
  if(index < 0) {
    throw "Illegal State: "+index+" ("+current_year+")";
  }

  var next_index = (index + 1) % all_years.length;
  var new_year = all_years[next_index];
  
  update_with_year(new_year);
  console.log("Updated map, year is now: "+new_year)
} 

Plotly.d3.json('https://raw.githubusercontent.com/fdevillard/ada-swissleak-website/master/data/number_closing_account_per_year_bis3.json',
  function(err, data_json){
    root_data = data_json;
    all_years = Object.keys(data_json);

    yearly_data = data_json[current_year];

    console.log(yearly_data);
    
    var data = [{
      type: 'choropleth',
      //locationmode: 'ISO-3',
      locations: yearly_data['locations'],
      z: yearly_data['values'],
      text: yearly_data['locations'],
      autocolorscale: true
    }];

    var layout = {
      height: 800,
      width: 800,
      geo: {
        projection: {
          type: 'mercator'
        }
      }
    };

    Plotly.plot(tester, data, layout, {showLink: false});
    

  });
</script>

<script>
w3IncludeHTML();

window.sr = ScrollReveal({
  scale: 1.0,
   duration: 1000,
   distance: "0px",
  // delay: 1000
  // top: window.height
});
$('.navbar').affix({
      offset: {
        top: $('header').height()
      }
}); 
sr.reveal('body>.container img');

$(window).scroll(function () {
    var scrollTop = $(window).scrollTop();
    var height = $(window).height();

    $('.full-header, .disclaimer').css({
        'opacity': ((height - scrollTop) / height)
    }); 
    $('.navbar').css({
        'opacity': 1 - ((height - scrollTop) / height)
    }); 
});

// sr.reveal('body>.container');
</script>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
